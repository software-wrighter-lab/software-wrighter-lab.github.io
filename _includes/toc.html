<nav class="toc">
  <h4>Contents</h4>
  <ul id="toc-list"></ul>
</nav>

<style>
.toc {
  background: #fffde7;
  border-radius: 8px;
  padding: 1rem 1.5rem;
  margin: 0 1.5rem 1rem 0;
  float: left;
  max-width: 280px;
}

[data-theme="dark"] .toc {
  background: #3d3a00;
}

@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .toc {
    background: #3d3a00;
  }
}

.toc h4 {
  margin: 0 0 0.75rem 0;
  font-size: 1rem;
}

.toc ul {
  margin: 0;
  padding-left: 1.25rem;
  list-style-type: disc;
}

.toc li {
  margin: 0.25rem 0;
}

.toc li.toc-h3 {
  margin-left: 1rem;
  font-size: 0.95em;
}

.toc a {
  text-decoration: none;
}

.toc a:hover {
  text-decoration: underline;
}

/* Clear float after first section */
.post-content h2:first-of-type {
  clear: both;
}

@media (max-width: 600px) {
  .toc {
    float: none;
    max-width: 100%;
    margin: 0 0 1.5rem 0;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const article = document.querySelector('.post-content');
  const tocList = document.getElementById('toc-list');

  if (!article || !tocList) return;

  const headings = article.querySelectorAll('h2, h3');

  if (headings.length < 3) {
    // Hide TOC if fewer than 3 headings
    document.querySelector('.toc').style.display = 'none';
    return;
  }

  headings.forEach(function(heading, index) {
    // Add ID if missing
    if (!heading.id) {
      heading.id = 'heading-' + index;
    }

    const li = document.createElement('li');
    li.className = 'toc-' + heading.tagName.toLowerCase();

    const a = document.createElement('a');
    a.href = '#' + heading.id;
    a.textContent = heading.textContent;

    li.appendChild(a);
    tocList.appendChild(li);
  });
});
</script>
